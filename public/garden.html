<!DOCTYPE html>
<html>
<head>
	<title>DRIP Garden</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,700">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
<style>
  body { background-color:#222; color:#FFF; font-family:'Ubuntu', sans-serif; padding:20px; font-size:20px; line-height:105%; }
  input { background-color:#444; color:#FFF; width:160px; text-align:right; padding:5px 10px 5px 10px; outline:none; border-style:solid; border:0; }
  td { padding:10px 10px;  border-bottom:5px solid #222; }
  td:first-child { background-color:#111; }
  td:last-child { text-align:right; background-color:#282828; }
  td > div { padding-right:10px; }
  .font-sm { font-size:13px; }
</style>
</head>
<body>
    <div id="app">
      <h1>DRIP Garden</h1>
      <table>
        <tr> <td>Plants grown</td> <td><input v-model="user.plants" v-on:keyup="userSave()" /></td> </tr>
        <tr> <td>Seeds available <div class="font-sm">1 plant = 2 592 200 seeds</div></td> <td><input v-model="user.seeds" v-on:keyup="userSave()" /></td> </tr>
        <tr> <td>Seeds / day <div class="font-sm">1 plant = 86 400 seeds / day</div></td> <td><div>{{ seeds_per_day|numSpace }}</div></td> </tr>
        <tr> <td>Plants ready</td> <td><div>{{ plants_ready }}</div></td> </tr>
        <tr> <td>Seeds needed <div class="font-sm">For next plant</div></td> <td><div>{{ seeds_needed|numSpace }}</div></td> </tr>
        <tr> <td>Seeds lost <div class="font-sm">If planted now</div></td> <td><div>{{ seeds_lost|numSpace }}</div></td> </tr>
        <tr> <td>Next Plant</td> <td><div>{{ plant_next_date }}</div></td> </tr>
        
        
      </table>
    </div><!-- APP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script><!-- PROD <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script> -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script>
// ----------------------------------------------------------------------------------------
// -- TOOLS -------------------------------------------------------------------------------
// ----------------------------------------------------------------------------------------
async function API_Get(url, callback) {
    //try {
        req = await fetch(url);
        res = await req.json();
    //} catch { callback({}); }

    callback(res);
}

$Cookie = {
    get: function (c_name) {
        var i,x,y,ARRcookies=document.cookie.split(";");
        for (i=0;i<ARRcookies.length;i++) {
            x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));
            y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);
            x=x.replace(/^\s+|\s+$/g,"");
            if (x==c_name) { return unescape(y); }
        }
    },
    set: function (c_name, value, exdays)  {
        if (!exdays) { exdays = 365; }
        var exdate=new Date();
        exdate.setDate(exdate.getDate() + exdays);
        var c_value=escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());
        document.cookie=c_name + "=" + c_value + "; path=/";
    },
    delete: function (name) {  
        FW.Cookie.Set(name, "");
    }
};

String.prototype.replaceAll = function (search, replacement) {
    var target = this;
    return target.replace(new RegExp(search, 'g'), replacement);
}

// ----------------------------------------------------------------------------------------
// -- APP ---------------------------------------------------------------------------------
// ----------------------------------------------------------------------------------------
var app = new Vue({
    el: '#app',
    data: {
      user: {
        plants: 10,
        seeds: 3000000
      },
      seeds_per_day: 0,
      plants_ready: 0,
      seeds_lost: 0,
      seeds_needed: 0,
      plant_next_date: 0
    },
    watch: {
        user: function () { this.userSave(); }
    },
    created: function () {
      this.userLoad();
    },

    methods: {
      updateUI() {
        this.seeds_per_day = (this.user.plants * 86400);
        this.plants_ready = Math.floor(this.user.seeds / 2592200);
        this.seeds_lost = this.user.seeds - (this.plants_ready * 2592200);
        this.seeds_needed = 2592200 - this.seeds_lost;
        seeds_per_minute = this.seeds_per_day / 24 / 60;
        plant_next_minute = this.seeds_needed / seeds_per_minute;
        this.plant_next_date = moment().add(plant_next_minute, 'minutes').format('MMM D h:mm A');
        if (this.plant_next_date.indexOf("NaN") != -1) { this.plant_next_date = ""; }
      },
      action(event, cmd) {
        var val = event.target.getAttribute("data-val");
        this.execute(cmd, val);
      },
      execute(cmd, val) {
        switch (cmd) {
            //case "test":           this.test(val); break;
        }
      },
      userLoad() {
        saved_data = $Cookie.get("USER-GARDEN");
        if (saved_data == undefined) { saved_data = JSON.stringify(this.user); }
        saved_data = JSON.parse(saved_data);
        this.user = saved_data;
        this.updateUI();
      },
      userSave() {
        $Cookie.set("USER-GARDEN", JSON.stringify(this.user));
        console.log("User Saved");
        this.updateUI();
      }
    },    
    computed: {

    },
    filters: {
      decimal_3: function (value) {
        value = parseFloat(value).toFixed(3);
        if (value == "NaN") { value = 0; } 
        return value;
      },
      numSpace(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
      }
    }
  });

// ----------------------------------------------------------------------------------------
// -- TOOLS -------------------------------------------------------------------------------
// ----------------------------------------------------------------------------------------
async function API_Get(url, callback) {
    req = await fetch(url);
    res = await req.json();
    callback(res);
}

</script>
</body>
</html>

